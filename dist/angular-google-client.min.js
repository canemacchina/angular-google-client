!function(){"use strict";angular.module("cm-google-api",[])}(),function(){"use strict";angular.module("cm-google-api").provider("googleClient",function(){var e,t,i,n=[],o=0,c=0,r=[],a=[],u=!1,l=!1,s=!1,d=!1,f=!1,p=!1,g=!1,h=function(){0===--o&&(d=!0,f=!1,u?gapi.auth.authorize({client_id:e,scope:n,immediate:!0},function(){t.resolve()}):t.resolve())},m=function(){0===--c&&(p=!0,g=!1,i.resolve())},v=function(){var t=!1;return l&&(t=!0,gapi.load("client",{callback:m})),s&&("undefined"==typeof e?i.reject("you need to provide the clientId if you load Picker script"):(t=!0,gapi.load("picker",{callback:m}),gapi.load("auth",{callback:m}))),t},k=function(){var e=!1;return angular.forEach(a,function(t){e=!0,gapi.client.load(t.api,t.version,h,t.baseUrl)}),angular.forEach(r,function(t){e=!0,gapi.client.load(t.api,t.version,h)}),!l||e},b=function(){return l||(l=!0,c++),this};this.loadPickerLibrary=function(){return s||(s=!0,c+=2),this},this.addApi=function(e,t,i){b();var n={};return n.api=e,n.version=t,o++,"undefined"==typeof i?r.push(n):(n.baseUrl=i,a.push(n)),this},this.setAutomaticAuth=function(){return u=!0,this.addScope("https://www.googleapis.com/auth/userinfo.email"),this},this.addScope=function(e){return n+=" "+e,this},this.setClientId=function(t){return e=t,this},this.$get=["$q","$window","$document",function(o,c,r){return{afterScriptsLoaded:function(){if(!p&&!g){g=!0,i=o.defer(),c._cmGoogleClientInitCallback=function(){v()||i.reject("at least you need to add some api or load picker.js")};var e=r[0].createElement("script");e.onerror=function(e){i.reject(e)},e.src="https://apis.google.com/js/api.js?onload=_cmGoogleClientInitCallback",r[0].body.appendChild(e)}return i.promise},afterApiLoaded:function(){return d||f||(t=o.defer(),f=!0,this.afterScriptsLoaded().then(function(){k()||t.reject("at least you nedd to load an Api")},function(e){t.reject(e)})),t.promise},clientId:e,scopes:n}}]})}(),function(){"use strict";angular.module("cm-google-api").service("googleClientService",["$q","googleClient",function(e,t){this.execute=function(i,n){var o=e.defer();return t.afterApiLoaded().then(function(){i=i.split(".");var e=gapi.client;angular.forEach(i,function(t){e=e[t]},e);var t;t="undefined"==typeof n?e():e(n),t.then(function(e){o.resolve(e)},function(e){o.reject(e)})},function(e){o.reject(e)}),o.promise}}])}(),function(){"use strict";angular.module("cm-google-api").directive("cmGooglePicker",["googleClient","$q","$window",function(e,t,i){var n,o,c=null;return{restrict:"A",scope:{scopes:"=",locale:"@",views:"&",onPicked:"="},link:function(r,a,u){function l(){return n||c||(o=t.defer(),gapi.auth.authorize({client_id:e.clientId,scope:r.scopes,immediate:!1},s)),o.promise}function s(e){n=!1,e&&!e.error?(c=e.access_token,o.resolve()):o.reject()}function d(e){r.onPicked&&e.action===google.picker.Action.PICKED&&r.onPicked(e.docs)}function f(){e.afterScriptsLoaded().then(function(){l().then(function(){var e=(new google.picker.PickerBuilder).setLocale(r.locale).setOAuthToken(c).setOrigin(i.location.protocol+"//"+i.location.host).setCallback(d),t=r.views();angular.forEach(t,function(t){e.addView(t)}),e=e.build(),e.setVisible(!0)})})}n=!0,e.afterScriptsLoaded().then(function(){o=t.defer(),gapi.auth.authorize({client_id:e.clientId,scope:r.scopes,immediate:!0},s)}),a.bind("click",function(e){f()})}}}])}();
//# sourceMappingURL=angular-google-client.min.js.map