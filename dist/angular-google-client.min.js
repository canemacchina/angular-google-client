!function(){"use strict";angular.module("cm-google-api",[])}(),function(){"use strict";angular.module("cm-google-api").provider("googleClient",function(){var e,i,t,n=[],o=0,c=0,r=[],a=[],u=!1,l=!1,s=!1,f=!1,d=!1,p=!1,g=!1,h=function(){0===--o&&(f=!0,d=!1,u?gapi.auth.authorize({client_id:e,scope:n,immediate:!0},function(){i.resolve()}):i.resolve())},m=function(){0===--c&&(p=!0,g=!1,t.resolve())};this.addApi=function(e,i,t){var n={};return n.api=e,n.version=i,o++,"undefined"==typeof t?r.push(n):(n.baseUrl=t,a.push(n)),this},this.setAutomaticAuth=function(){return u=!0,this.addScope("https://www.googleapis.com/auth/userinfo.email"),this},this.loadClientLibrary=function(){return l=!0,c++,this},this.loadPickerLibrary=function(){return s=!0,c++,this},this.addScope=function(e){return n+=" "+e,this},this.setClientId=function(i){return e=i,this},this.$get=["$q","$window","$document",function(o,c,u){return{afterScriptsLoaded:function(){if(!p&&!g){g=!0,t=o.defer(),c._cmGoogleClientInitCallback=function(){l&&gapi.load("client",{callback:m}),s&&gapi.load("picker",{callback:m})};var e=u[0].createElement("script");e.onerror=function(e){t.reject(e)},e.src="https://apis.google.com/js/api.js?onload=_cmGoogleClientInitCallback",u[0].body.appendChild(e)}return t.promise},afterApiLoaded:function(){return f||d||(i=o.defer(),d=!0,this.afterScriptsLoaded().then(function(){angular.forEach(a,function(e){gapi.client.load(e.api,e.version,h,e.baseUrl)}),angular.forEach(r,function(e){gapi.client.load(e.api,e.version,h)})},function(e){i.reject(e)})),i.promise},clientId:e,scopes:n}}]})}(),function(){"use strict";angular.module("cm-google-api").service("googleClientService",["$q","googleClient",function(e,i){this.execute=function(t,n){var o=e.defer();return i.afterApiLoaded().then(function(){t=t.split(".");var e=gapi.client;angular.forEach(t,function(i){e=e[i]},e);var i;i="undefined"==typeof n?e():e(n),i.then(function(e){o.resolve(e)},function(e){o.reject(e)})},function(e){o.reject(e)}),o.promise}}])}(),function(){"use strict";angular.module("cm-google-api").directive("cmGooglePicker",["googleClient","$q",function(e,i){var t=i.defer();return{restrict:"A",link:function(i,n,o){function c(){return l||gapi.auth.authorize({client_id:e.clientId,scope:"https://www.googleapis.com/auth/drive",immediate:!1},r),t.promise}function r(e){e&&!e.error&&(l=e.access_token,t.resolve())}function a(e){e.action==google.picker.Action.LOADED,e.action==google.picker.Action.CANCEL,e.action==google.picker.Action.PICKED}function u(){e.afterScriptsLoaded().then(function(){c().then(function(){var e=(new google.picker.PickerBuilder).addView(google.picker.ViewId.DOCS).setOAuthToken(l).setCallback(a).build();e.setVisible(!0)})},function(){})}var l=null;n.bind("click",function(e){u()})}}}])}();
//# sourceMappingURL=angular-google-client.min.js.map