!function(){"use strict";angular.module("cmGoogleApi",[])}(),function(){"use strict";angular.module("cmGoogleApi").provider("googleClient",function(){var e,n,t,i="",o={},c=0,r=0,a=[],u=[],l=!1,s=!1,d=!1,f=!1,p=!1,g=!1,h=!1,v=!1,m=function(){0===--c&&(p=!0,g=!1,n.resolve())},k=function(){0===--r&&(h=!0,v=!1,t.resolve())},y=function(){var n=!1;return d&&("undefined"==typeof e?t.reject("you need to provide the clientId if you load google auth"):(n=!0,gapi.load("auth",{callback:k}),f&&gapi.load("auth2",function(){o.scope=i,o.client_id=e,gapi.auth2.init(o),k()}))),l&&(n=!0,gapi.load("client",{callback:k})),s&&("undefined"==typeof e?t.reject("you need to provide the clientId if you load google picker"):(n=!0,gapi.load("picker",{callback:k}))),n},A=function(){var e=!1;return angular.forEach(u,function(n){e=!0,gapi.client.load(n.api,n.version,m,n.baseUrl)}),angular.forEach(a,function(n){e=!0,gapi.client.load(n.api,n.version,m)}),!l||e},I=function(){l||(l=!0,r++)},b=function(e,n){d||(d=!0,e?(f=!0,r+=2,"object"==typeof n&&("undefined"!=typeof n.cookie_policy&&(o.cookie_policy=n.cookie_policy),"undefined"!=typeof n.hosted_domain&&(o.hosted_domain=n.hosted_domain),"undefined"!=typeof n.fetch_basic_profile&&(o.fetch_basic_profile=n.fetch_basic_profile))):r+=1)};this.loadGoogleSignInButton=function(e){return b(!0,e),this},this.loadGoogleAuth=function(){return b(!1),this},this.loadPickerLibrary=function(){return s||(s=!0,r++),this},this.addApi=function(e,n,t){I();var i={};return i.api=e,i.version=n,c++,"undefined"==typeof t?a.push(i):(i.baseUrl=t,u.push(i)),this},this.addScope=function(e){return i+=" "+e,this},this.setClientId=function(n){return e=n,this},this.$get=["$q","$window","$document",function(o,c,r){return{afterScriptsLoaded:function(){if(!h&&!v){v=!0,t=o.defer(),c._cmGoogleClientInitCallback=function(){y()||t.reject("at least you need to add some api, load picker library or load google auth")};var e=r[0].createElement("script");e.onerror=function(e){t.reject(e)},e.src="https://apis.google.com/js/api.js?onload=_cmGoogleClientInitCallback",r[0].body.appendChild(e)}return t.promise},afterApiLoaded:function(){return p||g||(n=o.defer(),g=!0,this.afterScriptsLoaded().then(function(){A()||n.reject("at least you need to load an Api")},function(e){n.reject(e)})),n.promise},clientId:e,scopes:i.trim(),checkAuth:function(){var n=o.defer();if(f)this.afterScriptsLoaded().then(function(){var e=gapi.auth2.getAuthInstance();e.then(function(){n.resolve(e.isSignedIn.get())},function(e){n.reject(e)})},function(e){n.reject(e)});else{var t=function(e){e&&!e.error?n.resolve(!0):n.resolve(!1)};this.afterScriptsLoaded().then(function(){gapi.auth.authorize({client_id:e,scope:i.trim(),immediate:!0},t)},function(e){n.reject(e)})}return n.promise}}}]})}(),function(){"use strict";angular.module("cmGoogleApi").service("cmApiService",["$q","googleClient",function(e,n){this.execute=function(t,i){var o=e.defer();return n.afterApiLoaded().then(function(){t=t.split(".");var e=gapi.client;angular.forEach(t,function(n){e=e[n]},e);var n;n="undefined"==typeof i?e():e(i),n.then(function(e){o.resolve(e)},function(e){o.reject(e)})},function(e){o.reject(e)}),o.promise}}])}(),function(){"use strict";angular.module("cmGoogleApi").service("cmAuthService",["$q","googleClient",function(e,n){this.getAuthInstance=function(){var t=e.defer();return n.afterScriptsLoaded().then(function(){var e=gapi.auth2.getAuthInstance();e.then(function(){var n=e.then;e.then=void 0,t.resolve(e),e.then=n},function(e){t.reject(e)})},function(e){t.reject(e)}),t.promise}}])}(),function(){"use strict";angular.module("cmGoogleApi").directive("cmGooglePicker",["googleClient","$q","$window",function(e,n,t){return{restrict:"A",scope:{locale:"@",views:"&",onPicked:"="},link:function(n,i,o){function c(e){n.onPicked&&e.action===google.picker.Action.PICKED&&n.$apply(n.onPicked(e.docs))}function r(){e.afterScriptsLoaded().then(function(){var e=(new google.picker.PickerBuilder).setLocale(n.locale).setOAuthToken(gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().access_token).setOrigin(t.location.protocol+"//"+t.location.host).setCallback(c),i=n.views();angular.forEach(i,function(n){e.addView(n)}),e=e.build(),e.setVisible(!0)})}i.bind("click",function(e){r()})}}}])}(),function(){"use strict";angular.module("cmGoogleApi").directive("cmGoogleSignIn",["$http","googleClient",function(e,n){return{restrict:"E",transclude:!0,replace:!0,scope:{clickHandler:"=",signInListener:"=",userListener:"="},template:"<ng-transclude></ng-transclude>",link:function(e,t,i){function o(n){e.$apply(e.clickHandler(n))}function c(n){gapi.auth.setToken(n.getAuthResponse()),e.$apply(e.userListener(n))}function r(n){e.$apply(e.signInListener(n))}"undefined"==typeof e.clickHandler&&(e.clickHandler=angular.noop),n.afterScriptsLoaded().then(function(){var n=gapi.auth2.getAuthInstance();"undefined"!=typeof e.signInListener&&n.isSignedIn.listen(r),"undefined"!=typeof e.userListener&&n.currentUser.listen(c),n.attachClickHandler(t[0],{},o,function(e){})},function(e){})}}}])}();
//# sourceMappingURL=angular-google-client.min.js.map
